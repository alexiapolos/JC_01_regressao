---
title: "Journal Club 1: Modelos de regressão - banco de dados genérico em oncologia"
author: "LiaaOnco"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
---
# Introdução

## Introdução

Nesta aula prática, aplicaremos modelos de regressão ao **Haberman's Survival Data Set**, que contém informações sobre pacientes submetidos à cirurgia de câncer de mama. Os objetivos incluem:
1. Explorar relações lineares e não lineares entre variáveis.
2. Avaliar fatores preditivos para a sobrevivência de 5 anos ou mais.
3. Interpretar e comparar os modelos ajustados.

O dataset contém:
- **Idade**: Idade no momento da cirurgia.
- **Ano da cirurgia**: Ano em que a cirurgia foi realizada.
- **Nódulos axilares positivos**: Número detectado.
- **Status de sobrevivência**: Classe categórica (1 = Sobreviveu 5 anos ou mais; 2 = Não sobreviveu).


## Carregamento de dados e pacotes

```{r, include = FALSE}
library(tidyverse)
library(caret)
library(ggpmisc)
library(broom)

# Carregar os dados
dados <- read.csv("cancer.csv", header = FALSE, 
                  col.names = c("idade", "ano_cirurgia", "nodulos_positivos", "sobrevivencia")) %>%
  mutate(
    sobrevivencia = factor(sobrevivencia, levels = c(1, 2), labels = c("Sobreviveu", "Não Sobreviveu"))
  )

# Visualizar os dados
glimpse(dados)


```

You can add options to executable code like this

```{r}
glimpse(dados)
```

## Particionamento

```{r}
set.seed(123)

# Divisão em treino e teste
train_index <- createDataPartition(dados$sobrevivencia, p = 0.8, list = FALSE)
train_data <- dados[train_index, ]
test_data <- dados[-train_index, ]

dim(train_data)
dim(test_data)

```
## Regressão Linear Simples

**Objetivo**: Analisar a relação entre a idade do paciente e o número de nódulos axilares positivos detectados.

### Modelagem

```{r}
# Ajuste do modelo
linear_model <- lm(nodulos_positivos ~ idade, data = train_data)

# Resumo do modelo
summary(linear_model)

# Métricas
linear_preds <- test_data %>%
  mutate(pred = predict(linear_model, newdata = test_data))

linear_metrics <- linear_preds %>%
  summarise(
    R2 = cor(nodulos_positivos, pred)^2,
    RMSE = sqrt(mean((nodulos_positivos - pred)^2))
  )

linear_metrics

```

### Visualizaçãoo

```{r}
ggplot(train_data, aes(x = idade, y = nodulos_positivos)) +
  geom_point(color = "darkblue", alpha = 0.8) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(
    title = "Regressão Linear Simples",
    x = "Idade do Paciente",
    y = "Nódulos Axilares Positivos"
  ) +
  theme_minimal()

```

## Regressão Linear Múltipla

**Objetivo**: Avaliar o impacto da idade, ano da cirurgia e número de nódulos axilares no status de sobrevivência (categórico).

### Modelagem

```{r}
# Ajuste do modelo (Regressão Logística)
multiple_model <- glm(sobrevivencia ~ idade + ano_cirurgia + nodulos_positivos, 
                      data = train_data, family = binomial)

# Resumo
summary(multiple_model)

# Previsões e matriz de confusão
multiple_preds <- test_data %>%
  mutate(
    prob = predict(multiple_model, newdata = test_data, type = "response"),
    pred = ifelse(prob > 0.5, "Sobreviveu", "Não Sobreviveu")
  )

conf_matrix <- table(Predito = multiple_preds$pred, Real = test_data$sobrevivencia)
conf_matrix

```

### Visualização dos residuos

```{r}
library (broom)
residuals <- augment(multiple_model) %>%
  select(.fitted, .resid)

ggplot(residuals, aes(x = .fitted, y = .resid)) +
  geom_point() +
  labs(
    title = "Resíduos da Regressão Múltipla",
    x = "Valores Ajustados",
    y = "Resíduos"
  ) +
  theme_minimal()

```

## Modelo Não Linear

**Objetivo**: Explorar a relação não linear entre a idade e o número de nódulos axilares detectados.

### Modelagem

```{r}
# Ajuste do modelo polinomial
nonlinear_model <- lm(nodulos_positivos ~ poly(idade, 2), data = train_data)

# Resumo
summary(nonlinear_model)

# Previsão e visualização
train_data <- train_data %>%
  mutate(pred = predict(nonlinear_model, newdata = train_data))

ggplot(train_data, aes(x = idade, y = nodulos_positivos)) +
  geom_point(color = "darkblue", alpha = 0.7) +
  geom_line(aes(y = pred), color = "red", size = 1.2) +
  labs(
    title = "Modelo Não Linear: Idade x Nódulos Positivos",
    x = "Idade do Paciente",
    y = "Nódulos Axilares Positivos"
  ) +
  theme_minimal()

```

### Visualização

```{r}

```

## Comparação de Modelos

**Objetivo**: Comparar os modelos ajustados em termos de explicabilidade (R²) e desempenho.


```{r, echo = FALSE}
cat("Regressão Linear Simples: R² =", summary(linear_model)$r.squared, "\n")
cat("Regressão Múltipla (Logística): AIC =", AIC(multiple_model), "\n")
cat("Modelo Não Linear: R² =", summary(nonlinear_model)$r.squared, "\n")


```

### Discussão
Regressão Linear Simples:

Mostrou uma relação significativa entre Cell.size e Cl.thickness.
R² indica a porcentagem de variação explicada.
Regressão Múltipla:

A combinação de variáveis preditoras mostrou ser útil na classificação entre tumores benignos e malignos.
A matriz de confusão avalia a acurácia.
Modelo Não Linear:

Capturou melhor a relação entre Cell.size e Cl.thickness, indicando um comportamento não linea